(this["webpackJsonpfront-companion"]=this["webpackJsonpfront-companion"]||[]).push([[0],{43:function(e,t,n){e.exports=n(60)},59:function(e,t,n){},60:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(36),l=n.n(r),o=n(9),u=n(30),i=n(37),s=Object(a.createContext)(null),m=function(){return Object(a.useContext)(s).state},d=function(e,t){return console.log(t,t.value),"secret_set"===t.type?Object(u.a)({},e,{secret:t.value}):"new_context_received"===t.type?Object(u.a)({},e,{frontContext:t.value}):e},f=function(e){var t=e.children,n=Object(a.useReducer)(d,null),r=Object(o.a)(n,2),l=r[0],u=r[1];Object(a.useEffect)((function(){var e=new URL(document.location.href).searchParams.get("auth_secret");console.log("Secret is ".concat(e)),u({type:"secret_set",value:e});var t=i.contextUpdates.subscribe((function(e){return u({type:"new_context_received",value:e})}));return function(){return t.unsubscribe()}}),[]);var m=Object(a.useMemo)((function(){return{state:l,dispatch:u}}),[l,u]);return(null===l||void 0===l?void 0:l.frontContext)?c.a.createElement(s.Provider,{value:m},t):null},v=n(25),E=n(41),b=n(2),p=n(39),h=function(e){var t=e.value,n=p.DateTime.fromISO(t);return n.invalid?c.a.createElement("em",null,"Invalid date"):n.toFormat("D")},O=function(e){var t=e.value;return"Invalid Date"!==new Date(t).toString()&&new Date(t).toISOString()===t?c.a.createElement(h,{value:t}):Array.isArray(t)&&!t.find((function(e){return!!e}))?c.a.createElement(c.a.Fragment,null,"N/A"):Array.isArray(t)?c.a.createElement(c.a.Fragment,null,t.join(", ")):c.a.createElement(c.a.Fragment,null,t||"N/A")},j=function(e){var t=e.contactKey,n=m().secret,r=Object(a.useState)(!0),l=Object(o.a)(r,2),u=l[0],i=l[1],s=Object(a.useState)({}),d=Object(o.a)(s,2),f=d[0],v=d[1],E=Object(a.useState)(null),b=Object(o.a)(E,2),p=b[0],h=b[1],j=Object(a.useState)(0),g=Object(o.a)(j,2),y=g[0],N=g[1],x=function(e,t){var n=y+e;return-1===n&&(n=t-1),n===t&&(n=0),N(n)};return Object(a.useEffect)((function(){if(f.contactKey!==t){var e="/api/search?auth_secret=".concat(n,"&contact_key=").concat(encodeURIComponent(t)),a={contactKey:t};i(!0),h(null),N(0),fetch("".concat(e),{method:"GET",mode:"cors"}).then((function(e){if(!e.ok&&404!==e.status)throw Error(e.statusText);return 404===e.status?{}:e.json()})).then((function(e){return v(Object.assign(a,{data:e.data}))})).catch((function(e){v(a),h(e.message)})).finally((function(){return i(!1)}))}}),[f,t,n]),u?c.a.createElement("div",{className:"notice"},"Loading..."):p?c.a.createElement("div",{className:"notice error"},p):f&&f.data?c.a.createElement("div",{className:"info"},c.a.createElement("div",{className:"info-contact"},c.a.createElement("ul",{className:"list-data"},c.a.createElement("div",{className:"index-picker"},c.a.createElement("span",{className:"index-picker-button",onClick:function(){return x(-1,f.data.length)}},"<<"),c.a.createElement("span",null," ",y+1," / ",f.data.length," "),c.a.createElement("span",{className:"index-picker-button",onClick:function(){return x(1,f.data.length)}},">>")),Object.entries(f.data[y]).map((function(e,t){return c.a.createElement("li",{key:t},c.a.createElement("div",{className:"info-entry"},c.a.createElement("div",{className:"info-label"},e[0]),c.a.createElement("div",{className:"info-value"},c.a.createElement(O,{value:e[1]}))))}))))):c.a.createElement("div",{className:"notice"},"No record found.")},g=function(e){var t=e.contacts,n=e.currentContact,a=e.setContact;return n?c.a.createElement("div",{className:"select-container"},c.a.createElement("select",{className:"select-contact",value:n,onChange:function(e){return a(e.target.value)}},t.map((function(e){return c.a.createElement("option",{key:e},e)}))),c.a.createElement("i",{className:"chevron-down"},"\u2304")):c.a.createElement(c.a.Fragment,null)},y=function(){var e=Object(a.useState)([]),t=Object(o.a)(e,2),n=t[0],r=t[1],l=m().frontContext,u=l.type,i=l.conversation,s=Object(a.useState)(null),d=Object(o.a)(s,2),f=d[0],p=d[1];return Object(a.useEffect)((function(){l.listMessages&&l.listMessages().then((function(e){var t,n=e.results.map((function(e){var t,n,a;return[].concat(Object(v.a)(e.to.map((function(e){return e.handle}))),[null===(t=e.from)||void 0===t?void 0:t.handle],Object(v.a)((null===(n=e.cc)||void 0===n?void 0:n.map((function(e){return e.handle})))||[]),Object(v.a)((null===(a=e.bcc)||void 0===a?void 0:a.map((function(e){return e.handle})))||[]))})).flat().filter((function(e,t,n){return n.indexOf(e)===t}));p(null===i||void 0===i||null===(t=i.recipient)||void 0===t?void 0:t.handle),r(n)}))}),[l,i]),c.a.createElement("div",{className:"app"},c.a.createElement(E.a,{basename:""},c.a.createElement(b.c,null,c.a.createElement(b.a,{path:"/"},"singleConversation"===u&&f?c.a.createElement(c.a.Fragment,null,c.a.createElement(g,{contacts:n,currentContact:f,setContact:p}),c.a.createElement(j,{contactKey:f})):c.a.createElement("div",{className:"notice"},"This plugin only works with conversations.")))))};n(59),t.default=y;l.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(f,null,c.a.createElement(y,null))),document.getElementById("root"))}},[[43,1,2]]]);
//# sourceMappingURL=main.0b92a137.chunk.js.map