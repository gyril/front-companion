(this["webpackJsonpfront-companion"]=this["webpackJsonpfront-companion"]||[]).push([[0],{43:function(e,t,a){e.exports=a(60)},59:function(e,t,a){},60:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),r=a(36),l=a.n(r),o=a(9),i=a(26),u=a(37),s=Object(n.createContext)(null),m=function(){return Object(n.useContext)(s).state},d=function(e,t){return console.log(t,t.value),"secret_set"===t.type?Object(i.a)({},e,{secret:t.value}):"airtable_credentials_set"===t.type?Object(i.a)({},e,{airtableKey:t.value.airtable_key,airtableBase:t.value.airtable_base}):"new_context_received"===t.type?Object(i.a)({},e,{frontContext:t.value}):e},f=function(e){var t=e.children,a=Object(n.useReducer)(d,null),r=Object(o.a)(a,2),l=r[0],i=r[1];Object(n.useEffect)((function(){var e=new URL(document.location.href).searchParams.get("auth_secret");console.log("Secret is ".concat(e)),i({type:"secret_set",value:e});var t=new URL(document.location.href).searchParams.get("airtable_key"),a=new URL(document.location.href).searchParams.get("airtable_base");t&&a&&i({type:"airtable_credentials_set",value:{airtable_key:t,airtable_base:a}});var n=u.contextUpdates.subscribe((function(e){return i({type:"new_context_received",value:e})}));return function(){return n.unsubscribe()}}),[]);var m=Object(n.useMemo)((function(){return{state:l,dispatch:i}}),[l,i]);return(null===l||void 0===l?void 0:l.frontContext)?c.a.createElement(s.Provider,{value:m},t):null},v=a(25),b=a(41),E=a(2),h=a(39),p=function(e){var t=e.value,a=h.DateTime.fromISO(t);return a.invalid?c.a.createElement("em",null,"Invalid date"):a.toFormat("D")},O=function(e){var t=e.value;return"Invalid Date"!==new Date(t).toString()&&new Date(t).toISOString()===t?c.a.createElement(p,{value:t}):Array.isArray(t)&&!t.find((function(e){return!!e}))?c.a.createElement(c.a.Fragment,null,"N/A"):Array.isArray(t)?c.a.createElement(c.a.Fragment,null,t.join(", ")):c.a.createElement(c.a.Fragment,null,t||"N/A")},j=function(e){var t=e.contactKey,a=m().secret,r=Object(n.useState)(!0),l=Object(o.a)(r,2),i=l[0],u=l[1],s=Object(n.useState)({}),d=Object(o.a)(s,2),f=d[0],v=d[1],b=Object(n.useState)(null),E=Object(o.a)(b,2),h=E[0],p=E[1];return Object(n.useEffect)((function(){if(f.contactKey!==t){var e="/api/search?auth_secret=".concat(a,"&contact_key=").concat(encodeURIComponent(t)),n={contactKey:t};u(!0),p(null),fetch("".concat(e),{method:"GET",mode:"cors"}).then((function(e){if(!e.ok&&404!==e.status)throw Error(e.statusText);return 404===e.status?{}:e.json()})).then((function(e){return v(Object.assign(n,{data:e.data}))})).catch((function(e){v(n),p(e.message)})).finally((function(){return u(!1)}))}}),[f,t,a]),i?c.a.createElement("div",{className:"notice"},"Loading..."):h?c.a.createElement("div",{className:"notice error"},h):f&&f.data?c.a.createElement("div",{className:"info"},c.a.createElement("div",{className:"info-contact"},c.a.createElement("ul",{className:"list-data"},Object.entries(f.data).map((function(e,t){return c.a.createElement("li",{key:t},c.a.createElement("div",{className:"info-entry"},c.a.createElement("div",{className:"info-label"},e[0]),c.a.createElement("div",{className:"info-value"},c.a.createElement(O,{value:e[1]}))))}))))):c.a.createElement("div",{className:"notice"},"No record found.")},y=function(e){var t=e.contacts,a=e.currentContact,n=e.setContact;return a?c.a.createElement("div",{className:"select-container"},c.a.createElement("select",{className:"select-contact",value:a,onChange:function(e){return n(e.target.value)}},t.map((function(e){return c.a.createElement("option",{key:e},e)}))),c.a.createElement("i",{className:"chevron-down"},"\u2304")):c.a.createElement(c.a.Fragment,null)},g=function(){var e=Object(n.useState)([]),t=Object(o.a)(e,2),a=t[0],r=t[1],l=m().frontContext,i=l.type,u=l.conversation,s=Object(n.useState)(null),d=Object(o.a)(s,2),f=d[0],h=d[1];return Object(n.useEffect)((function(){l.listMessages&&l.listMessages().then((function(e){var t,a=e.results.map((function(e){var t,a,n;return[].concat(Object(v.a)(e.to.map((function(e){return e.handle}))),[null===(t=e.from)||void 0===t?void 0:t.handle],Object(v.a)((null===(a=e.cc)||void 0===a?void 0:a.map((function(e){return e.handle})))||[]),Object(v.a)((null===(n=e.bcc)||void 0===n?void 0:n.map((function(e){return e.handle})))||[]))})).flat().filter((function(e,t,a){return a.indexOf(e)===t}));h(null===u||void 0===u||null===(t=u.recipient)||void 0===t?void 0:t.handle),r(a)}))}),[l,u]),c.a.createElement("div",{className:"app"},c.a.createElement(b.a,{basename:""},c.a.createElement(E.c,null,c.a.createElement(E.a,{path:"/"},"singleConversation"===i&&f?c.a.createElement(c.a.Fragment,null,c.a.createElement(y,{contacts:a,currentContact:f,setContact:h}),c.a.createElement(j,{contactKey:f})):c.a.createElement("div",{className:"notice"},"This plugin only works with conversations.")))))};a(59),t.default=g;l.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(f,null,c.a.createElement(g,null))),document.getElementById("root"))}},[[43,1,2]]]);
//# sourceMappingURL=main.d811b9ae.chunk.js.map